<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="The Ultimate Physics Preparation Suite for CBSE/CASE Class 12 (2025-26).">
    <title>CASE Physics 2025: Magnum Opus Edition</title>
    
    <!-- CORE LIBRARIES -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- MATHJAX CONFIG -->
    <script>
        window.MathJax = {
            tex: { inlineMath: [['$', '$'], ['\\(', '\\)']], displayMath: [['$$', '$$'], ['\\[', '\\]']] },
            svg: { fontCache: 'global' }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        /* --- COSMIC THEME SYSTEM --- */
        :root {
            --bg-void: #000000;
            --bg-nebula: #0B0F19;
            --glass-surface: rgba(18, 25, 40, 0.75);
            --glass-border: rgba(255, 255, 255, 0.08);
            --primary-core: #3B82F6;
            --primary-glow: rgba(59, 130, 246, 0.6);
            --accent-plasma: #F59E0B;
            --accent-success: #10B981;
            --accent-danger: #EF4444;
            --text-bright: #F8FAFC;
            --text-dim: #94A3B8;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-void);
            color: var(--text-bright);
            overflow-x: hidden;
            scroll-behavior: smooth;
        }

        /* --- ADVANCED UTILITIES --- */
        .glass-morphism {
            background: var(--glass-surface);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid var(--glass-border);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5);
        }

        .text-gradient-gold { background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .text-gradient-blue { background: linear-gradient(135deg, #60A5FA 0%, #3B82F6 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        .card-hover-3d { transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275), box-shadow 0.4s ease; }
        .card-hover-3d:hover { transform: translateY(-8px) scale(1.02); box-shadow: 0 25px 50px -12px rgba(59, 130, 246, 0.25); border-color: rgba(59, 130, 246, 0.4); }

        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #0F172A; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }

        /* --- STUDY CONTENT TYPOGRAPHY --- */
        .note-content h1 { font-size: 2.5rem; font-weight: 900; color: white; margin-bottom: 2rem; border-bottom: 1px solid #334155; padding-bottom: 1rem; }
        .note-content h2 { font-size: 1.8rem; font-weight: 700; color: #93C5FD; margin-top: 3rem; margin-bottom: 1rem; }
        .note-content h3 { font-size: 1.4rem; font-weight: 600; color: #E2E8F0; margin-top: 2rem; margin-bottom: 0.75rem; }
        .note-content p { font-size: 1.05rem; line-height: 1.7; color: #CBD5E1; margin-bottom: 1rem; }
        .note-content ul { list-style: none; padding-left: 1rem; margin-bottom: 1.5rem; }
        .note-content li { position: relative; padding-left: 1.5rem; margin-bottom: 0.5rem; color: #CBD5E1; }
        .note-content li::before { content: "►"; color: var(--primary-core); font-size: 0.8rem; position: absolute; left: 0; top: 0.2rem; }
        
        .formula-card {
            background: linear-gradient(145deg, #0F172A, #1E293B);
            border: 1px solid #334155;
            border-radius: 1rem;
            padding: 1.5rem;
            margin: 2rem 0;
            text-align: center;
            font-family: 'JetBrains Mono', monospace;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);
            position: relative;
            overflow: hidden;
        }
        .formula-card::before { content: "KEY FORMULA"; position: absolute; top: 0; left: 0; background: #3B82F6; color: white; font-size: 0.6rem; font-weight: bold; padding: 0.25rem 0.75rem; border-bottom-right-radius: 0.5rem; }

        .derivation-panel {
            border-left: 4px solid #10B981;
            background: rgba(16, 185, 129, 0.05);
            padding: 1.5rem;
            margin: 2rem 0;
            border-radius: 0 1rem 1rem 0;
        }

        /* --- 3D CANVAS --- */
        #hero-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }

        /* --- LAB TOOLS --- */
        .lab-viewport { background: #020617; border-radius: 1rem; border: 1px solid #1E293B; cursor: crosshair; }
        input[type=range] { -webkit-appearance: none; background: transparent; width: 100%; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 16px; width: 16px; border-radius: 50%; background: #fff; cursor: pointer; margin-top: -6px; box-shadow: 0 0 10px rgba(255,255,255,0.5); }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; cursor: pointer; background: #334155; border-radius: 2px; }

        /* --- EXAM MODE --- */
        .option-btn { @apply w-full text-left p-4 rounded-xl border border-gray-700 hover:border-blue-500 hover:bg-blue-500/10 transition-all mb-3 flex items-center gap-3; }
        .timer-glow { text-shadow: 0 0 10px rgba(239, 68, 68, 0.6); }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- 3D BACKGROUND -->
    <div id="hero-canvas"></div>

    <!-- NAVIGATION HEADER -->
    <header class="fixed top-0 w-full z-50 border-b border-white/5 bg-[#000205]/80 backdrop-blur-xl transition-all duration-300">
        <div class="max-w-[1800px] mx-auto px-6 h-20 flex items-center justify-between">
            <!-- Brand -->
            <div class="flex items-center gap-4 group cursor-pointer" onclick="app.navigate('dashboard')">
                <div class="relative w-12 h-12">
                    <div class="absolute inset-0 bg-blue-600 rounded-xl blur-lg opacity-30 group-hover:opacity-50 transition-opacity"></div>
                    <div class="relative w-full h-full bg-gradient-to-br from-gray-900 to-black rounded-xl border border-white/10 flex items-center justify-center shadow-2xl group-hover:scale-105 transition-transform">
                        <i class="fas fa-atom text-blue-400 text-2xl animate-spin-slow" style="animation-duration: 10s;"></i>
                    </div>
                </div>
                <div>
                    <h1 class="text-xl font-black tracking-tight text-white">CASE <span class="text-gradient-blue">PHYSICS</span></h1>
                    <div class="flex items-center gap-2">
                        <span class="w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"></span>
                        <span class="text-[10px] font-mono text-slate-500 uppercase tracking-widest">System Online</span>
                    </div>
                </div>
            </div>

            <!-- Main Menu -->
            <nav class="hidden xl:flex items-center gap-2 bg-white/5 p-1.5 rounded-2xl border border-white/5">
                <button onclick="app.navigate('dashboard')" class="nav-btn px-6 py-2.5 rounded-xl text-sm font-bold text-white bg-white/10 shadow-lg transition-all flex items-center gap-2" id="nav-dashboard">
                    <i class="fas fa-grid-2"></i> Dashboard
                </button>
                <button onclick="app.navigate('study')" class="nav-btn px-6 py-2.5 rounded-xl text-sm font-bold text-slate-400 hover:text-white hover:bg-white/5 transition-all flex items-center gap-2" id="nav-study">
                    <i class="fas fa-book-open"></i> Study Zone
                </button>
                <button onclick="app.navigate('lab')" class="nav-btn px-6 py-2.5 rounded-xl text-sm font-bold text-slate-400 hover:text-white hover:bg-white/5 transition-all flex items-center gap-2" id="nav-lab">
                    <i class="fas fa-flask"></i> 3D Lab
                </button>
                <button onclick="app.navigate('exam')" class="nav-btn px-6 py-2.5 rounded-xl text-sm font-bold text-slate-400 hover:text-white hover:bg-white/5 transition-all flex items-center gap-2" id="nav-exam">
                    <i class="fas fa-clock"></i> Simulator
                </button>
            </nav>

            <!-- User Status -->
            <div class="flex items-center gap-6">
                <!-- XP System -->
                <div class="hidden md:flex flex-col items-end group cursor-help">
                    <div class="flex items-center gap-2">
                        <span class="text-[10px] font-bold text-slate-500 uppercase tracking-wider">Rank</span>
                        <span class="text-xs font-bold text-white bg-gradient-to-r from-amber-500 to-orange-600 px-3 py-0.5 rounded shadow-lg shadow-amber-500/20">Level <span id="user-lvl">1</span></span>
                    </div>
                    <div class="w-36 h-1.5 bg-gray-800 rounded-full mt-1.5 overflow-hidden relative border border-white/5">
                        <div id="xp-bar" class="absolute top-0 left-0 h-full bg-blue-500 w-0 shadow-[0_0_10px_#3B82F6]"></div>
                    </div>
                </div>
                <!-- Streak -->
                <div class="flex items-center gap-2 bg-white/5 px-4 py-2 rounded-xl border border-white/5 hover:border-red-500/30 transition-all cursor-pointer">
                    <i class="fas fa-fire text-red-500 animate-pulse"></i>
                    <span class="font-mono font-bold text-white"><span id="streak-days">0</span> Day</span>
                </div>
            </div>
        </div>
    </header>

    <!-- CONTENT CONTAINER -->
    <div class="pt-28 pb-12 px-6 max-w-[1800px] mx-auto min-h-screen relative z-10">

        <!-- ======================= VIEW: DASHBOARD ======================= -->
        <div id="view-dashboard" class="space-y-12 animate-fade-in">
            
            <!-- Hero Section -->
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                <!-- Strategy Card -->
                <div class="lg:col-span-8 relative overflow-hidden rounded-[2.5rem] glass-morphism p-10 md:p-14 group">
                    <div class="absolute top-0 right-0 w-[600px] h-[600px] bg-blue-600/10 rounded-full blur-[100px] -translate-y-1/2 translate-x-1/3 group-hover:bg-blue-600/20 transition-all duration-1000"></div>
                    
                    <div class="relative z-10">
                        <div class="inline-flex items-center gap-3 px-4 py-2 rounded-full bg-blue-500/10 border border-blue-500/20 mb-8 backdrop-blur-md">
                            <span class="w-2 h-2 rounded-full bg-blue-400 animate-ping"></span>
                            <span class="text-xs font-bold text-blue-300 uppercase tracking-widest">Protocol: 2025-26 Active</span>
                        </div>
                        
                        <h1 class="text-6xl md:text-8xl font-black text-white mb-8 tracking-tighter leading-[0.9]">
                            PHYSICS <br>
                            <span class="text-gradient-blue">MASTERY</span>
                        </h1>
                        
                        <p class="text-xl text-slate-400 max-w-2xl leading-relaxed mb-10">
                            The definitive preparation suite for CASE & CBSE. 
                            Built on the blueprint where <strong class="text-white">Optics (18M)</strong> and <strong class="text-white">Magnetism (17M)</strong> dictate your success.
                        </p>

                        <div class="flex flex-wrap gap-4">
                            <button onclick="app.navigate('study')" class="px-8 py-4 bg-blue-600 hover:bg-blue-500 text-white font-bold rounded-2xl shadow-xl shadow-blue-600/20 transition-all transform hover:-translate-y-1 flex items-center gap-3">
                                Start Studying <i class="fas fa-arrow-right"></i>
                            </button>
                            <button onclick="app.navigate('exam')" class="px-8 py-4 bg-white/5 hover:bg-white/10 text-white font-bold rounded-2xl border border-white/10 backdrop-blur-md transition-all flex items-center gap-3">
                                <i class="fas fa-play"></i> Mock Test
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Quick Stats / Actions -->
                <div class="lg:col-span-4 flex flex-col gap-6">
                    <!-- Progress Card -->
                    <div class="glass-morphism p-8 rounded-[2.5rem] flex-1 flex flex-col justify-center relative overflow-hidden group">
                        <div class="absolute inset-0 bg-gradient-to-br from-green-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"></div>
                        <div class="relative z-10">
                            <div class="flex justify-between items-center mb-4">
                                <span class="text-xs font-bold text-slate-500 uppercase tracking-widest">Overall Progress</span>
                                <i class="fas fa-chart-line text-green-500 text-xl"></i>
                            </div>
                            <div class="text-5xl font-mono font-black text-white mb-2">12<span class="text-2xl text-slate-500">%</span></div>
                            <div class="w-full bg-gray-800 h-2 rounded-full overflow-hidden mb-2">
                                <div class="bg-green-500 h-full w-[12%] rounded-full shadow-[0_0_15px_rgba(16,185,129,0.5)]"></div>
                            </div>
                            <p class="text-xs text-slate-400">3 Chapters Completed</p>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <button onclick="app.openModal('hot-list')" class="glass-morphism p-6 rounded-3xl flex items-center gap-6 hover:bg-blue-500/10 transition-all border-l-4 border-blue-500 group">
                        <div class="w-14 h-14 rounded-2xl bg-blue-500/20 flex items-center justify-center text-blue-400 text-2xl group-hover:scale-110 transition-transform"><i class="fas fa-fire"></i></div>
                        <div class="text-left">
                            <h3 class="text-lg font-bold text-white">Probable Questions</h3>
                            <p class="text-xs text-slate-400">AI-predicted high yield set</p>
                        </div>
                    </button>

                    <button onclick="app.openModal('repeated-list')" class="glass-morphism p-6 rounded-3xl flex items-center gap-6 hover:bg-amber-500/10 transition-all border-l-4 border-amber-500 group">
                        <div class="w-14 h-14 rounded-2xl bg-amber-500/20 flex items-center justify-center text-amber-400 text-2xl group-hover:scale-110 transition-transform"><i class="fas fa-history"></i></div>
                        <div class="text-left">
                            <h3 class="text-lg font-bold text-white">High Frequency</h3>
                            <p class="text-xs text-slate-400">Repeated concepts (5 Years)</p>
                        </div>
                    </button>
                </div>
            </div>

            <!-- Blueprint Explorer -->
            <div class="space-y-8">
                <div class="flex flex-col md:flex-row md:items-end justify-between border-b border-gray-800 pb-6 gap-4">
                    <div>
                        <h2 class="text-3xl font-bold text-white mb-2">Blueprint Explorer</h2>
                        <p class="text-slate-400">Interactive question breakdown by marks distribution.</p>
                    </div>
                    <div class="flex bg-gray-900/80 p-1.5 rounded-2xl backdrop-blur-md overflow-x-auto" id="blueprint-tabs">
                        <!-- Tabs injected via JS -->
                    </div>
                </div>
                <div id="blueprint-content" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6 min-h-[300px]">
                    <!-- Content injected via JS -->
                </div>
            </div>

            <!-- Resource Archive -->
            <div class="pt-12 border-t border-white/5" id="resources-section">
                <div class="flex items-center justify-between mb-10">
                    <h2 class="text-3xl font-bold text-white">Official Archives</h2>
                    <span class="text-xs font-mono text-slate-500 bg-gray-900 px-3 py-1 rounded border border-gray-800 flex items-center gap-2">
                        <span class="w-2 h-2 rounded-full bg-green-500"></span> SYNCED
                    </span>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6" id="resources-grid">
                    <!-- Resources injected via JS -->
                </div>
            </div>
        </div>

        <!-- ======================= VIEW: STUDY ZONE ======================= -->
        <div id="view-study" class="view-section hidden animate-fade-in space-y-8 min-h-[85vh]">
            <div class="flex flex-col lg:flex-row gap-8 h-[calc(100vh-140px)]">
                <!-- Sidebar -->
                <div class="w-full lg:w-96 flex-shrink-0 glass-morphism rounded-3xl p-6 flex flex-col gap-6 h-full overflow-hidden border border-gray-800">
                    <div class="pb-4 border-b border-gray-700">
                        <h2 class="text-xl font-bold text-white mb-1">Syllabus</h2>
                        <div class="text-xs text-slate-400 uppercase tracking-widest font-bold">14 Chapters</div>
                    </div>
                    <div class="flex-grow overflow-y-auto custom-scrollbar space-y-2 pr-2" id="study-nav">
                        <!-- Nav Items Injected -->
                    </div>
                </div>

                <!-- Content Area -->
                <div class="flex-grow glass-morphism rounded-3xl overflow-hidden flex flex-col border border-gray-800 relative">
                    <!-- Toolbar -->
                    <div class="h-20 border-b border-gray-800 flex items-center justify-between px-10 bg-[#0B0F17]/80 backdrop-blur-md z-20">
                        <span class="text-xs font-bold text-blue-400 uppercase tracking-widest bg-blue-500/10 px-3 py-1 rounded border border-blue-500/20" id="study-chapter-tag">SELECT TOPIC</span>
                        <div class="flex gap-3">
                            <button class="w-10 h-10 rounded-xl bg-gray-800 text-slate-400 hover:text-white hover:bg-gray-700 flex items-center justify-center transition-colors" title="Bookmark"><i class="far fa-bookmark"></i></button>
                            <button class="w-10 h-10 rounded-xl bg-gray-800 text-slate-400 hover:text-white hover:bg-gray-700 flex items-center justify-center transition-colors" title="Print"><i class="fas fa-print"></i></button>
                        </div>
                    </div>
                    
                    <!-- Content -->
                    <div class="flex-grow overflow-y-auto p-12 custom-scrollbar note-content bg-[#0B0F17] relative z-10" id="study-content">
                        <div class="h-full flex flex-col items-center justify-center text-slate-500 gap-6">
                            <div class="w-32 h-32 rounded-full bg-gray-800/30 flex items-center justify-center animate-pulse">
                                <i class="fas fa-book-reader text-5xl opacity-30"></i>
                            </div>
                            <div class="text-center">
                                <h3 class="text-2xl font-bold text-slate-300 mb-2">Knowledge Base Ready</h3>
                                <p>Select a chapter from the sidebar to access detailed notes.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ======================= VIEW: 3D LAB ======================= -->
        <div id="view-lab" class="view-section hidden animate-fade-in space-y-16">
            <div class="text-center py-12">
                <h2 class="text-5xl font-black text-white mb-4">Physics Simulator</h2>
                <p class="text-slate-400 text-xl max-w-2xl mx-auto">Interactive environments to visualize fundamental principles.</p>
            </div>

            <!-- Circuit Lab -->
            <div class="glass-morphism p-10 rounded-[2.5rem] border-t-4 border-yellow-500">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
                    <div>
                        <h3 class="text-3xl font-bold text-white flex items-center gap-3"><i class="fas fa-bolt text-yellow-500"></i> Circuit Builder</h3>
                        <p class="text-sm text-slate-400 mt-1">Visualize Current, Voltage, and Resistance.</p>
                    </div>
                    <div class="px-4 py-2 bg-yellow-500/10 text-yellow-500 text-xs font-bold rounded-xl border border-yellow-500/20">Ohm's Law: V = IR</div>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Visualization -->
                    <div class="lg:col-span-2 bg-[#020617] rounded-3xl h-96 relative border border-gray-800 overflow-hidden flex items-center justify-center group shadow-inner">
                        <div class="absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-yellow-500/5 to-transparent"></div>
                        
                        <!-- Circuit SVG/HTML Representation -->
                        <div class="relative w-3/4 h-3/4 border-[8px] border-gray-700 rounded-3xl flex items-center justify-center shadow-2xl transition-all duration-300" id="circuit-wire">
                            <!-- Battery -->
                            <div class="absolute top-1/2 left-0 -translate-x-1/2 -translate-y-1/2 bg-[#020617] px-4 py-8 border-2 border-gray-700 rounded-xl flex flex-col gap-2 items-center z-10 shadow-xl">
                                <div class="w-12 h-2 bg-yellow-500 rounded-full shadow-[0_0_15px_rgba(234,179,8,0.5)]"></div>
                                <div class="w-6 h-2 bg-yellow-500 rounded-full"></div>
                                <span class="text-[10px] text-yellow-500 font-mono font-bold mt-1">DC SOURCE</span>
                            </div>
                            
                            <!-- Resistor -->
                            <div class="absolute top-0 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-[#020617] px-8 py-4 border-2 border-gray-700 rounded-xl z-10 shadow-xl">
                                <div class="w-24 h-8 border-b-4 border-gray-500 skew-x-[45deg] relative"></div>
                                <span class="text-[10px] text-slate-400 font-mono font-bold block text-center mt-2">R = 10Ω</span>
                            </div>

                            <!-- Flow Animation -->
                            <div id="electron-flow" class="absolute inset-0 opacity-0 transition-opacity duration-500">
                                <div class="absolute top-0 left-0 w-full h-full border-4 border-dashed border-blue-400/50 rounded-[20px] animate-[spin_4s_linear_infinite]"></div>
                            </div>

                            <!-- Bulb -->
                            <div id="circuit-bulb" class="absolute bottom-0 left-1/2 -translate-x-1/2 translate-y-1/2 w-20 h-20 rounded-full bg-gray-800 border-4 border-gray-600 flex items-center justify-center z-10 transition-all duration-300">
                                <i class="fas fa-lightbulb text-gray-600 text-4xl transition-colors duration-300" id="bulb-icon"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Controls -->
                    <div class="flex flex-col justify-center gap-8 bg-gray-900/30 p-8 rounded-3xl border border-gray-800">
                        <div>
                            <div class="flex justify-between items-end mb-4">
                                <label class="text-sm font-bold text-slate-300 uppercase tracking-wider">Voltage</label>
                                <span class="text-2xl font-mono text-yellow-400 font-bold" id="volt-display">0V</span>
                            </div>
                            <input type="range" min="0" max="24" value="0" class="w-full h-3 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-yellow-500 hover:accent-yellow-400 transition-all" oninput="lab.updateCircuit(this.value)">
                            <div class="flex justify-between text-xs text-slate-500 mt-2 font-mono"><span>0V</span><span>24V</span></div>
                        </div>

                        <div class="p-6 bg-gray-800/50 rounded-2xl border border-gray-700 text-center">
                            <div class="text-xs text-slate-500 uppercase font-bold tracking-widest mb-1">Current Flow</div>
                            <div class="text-5xl font-mono font-black text-white tracking-tighter" id="circuit-current">0.0</div>
                            <div class="text-xs text-blue-400 font-bold mt-1">AMPERES</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Optics Lab -->
            <div class="glass-morphism p-10 rounded-[2.5rem] border-t-4 border-pink-500">
                <div class="flex justify-between items-center mb-8">
                    <h3 class="text-2xl font-bold text-white flex items-center gap-3"><i class="fas fa-eye text-pink-500"></i> Ray Optics Engine</h3>
                    <div class="flex gap-2 bg-gray-900 p-1.5 rounded-xl border border-gray-800">
                        <button onclick="lab.updateLens('convex')" class="px-5 py-2 rounded-lg bg-pink-600 text-white text-xs font-bold shadow-lg transition-transform hover:scale-105">Convex Lens</button>
                        <button onclick="lab.updateLens('concave')" class="px-5 py-2 rounded-lg text-slate-400 hover:text-white hover:bg-gray-800 text-xs font-bold transition-all">Concave Lens</button>
                    </div>
                </div>
                <div class="relative w-full h-96 bg-[#020617] rounded-3xl border border-gray-800 overflow-hidden shadow-inner">
                    <canvas id="rayCanvas" class="w-full h-full cursor-crosshair"></canvas>
                    <div class="absolute bottom-4 left-4 bg-black/50 backdrop-blur-md px-4 py-2 rounded-lg border border-white/10 text-xs text-slate-300 font-mono">
                        X: <span id="mouse-x">0</span> Y: <span id="mouse-y">0</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- ======================= VIEW: EXAM SIMULATOR ======================= -->
        <div id="view-exam" class="view-section hidden animate-fade-in min-h-[85vh]">
            <div class="max-w-5xl mx-auto text-center py-24" id="exam-start-screen">
                <div class="inline-block p-10 rounded-full bg-red-500/10 mb-10 border border-red-500/20 shadow-[0_0_60px_rgba(239,68,68,0.2)] animate-pulse-soft">
                    <i class="fas fa-clock text-7xl text-red-500"></i>
                </div>
                <h2 class="text-7xl font-black text-white mb-8 tracking-tighter">Mock Exam</h2>
                <p class="text-xl text-slate-400 mb-16 max-w-2xl mx-auto leading-relaxed">
                    A full-scale simulation of the Class 12 Physics Board Exam. 
                    <br><strong class="text-white">3 Hours • 70 Marks • 33 Questions</strong>
                    <br>Randomized based on the 2025 Blueprint.
                </p>
                <button onclick="exam.start()" class="px-16 py-6 bg-red-600 hover:bg-red-500 text-white font-bold rounded-3xl text-2xl shadow-2xl shadow-red-600/40 transition-all transform hover:scale-105 flex items-center justify-center gap-4 mx-auto">
                    <span>Start Timer</span> <i class="fas fa-play text-sm"></i>
                </button>
            </div>

            <div id="exam-interface" class="hidden max-w-6xl mx-auto">
                <div class="sticky top-24 z-40 mb-10">
                    <div class="bg-[#0B0E14]/90 p-6 rounded-2xl border border-gray-800 backdrop-blur-md flex justify-between items-center shadow-2xl">
                        <div>
                            <h3 class="text-2xl font-bold text-white">Full Syllabus Mock #1</h3>
                            <div class="flex items-center gap-2 mt-1">
                                <span class="w-2 h-2 rounded-full bg-red-500 animate-pulse"></span>
                                <p class="text-xs text-slate-500 uppercase tracking-widest font-bold">Recording Active</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-8">
                            <div class="text-right">
                                <div class="text-4xl font-mono font-bold text-red-500 tabular-nums tracking-tight" id="exam-timer">03:00:00</div>
                                <div class="text-[10px] text-slate-500 font-bold uppercase tracking-widest text-right">Time Remaining</div>
                            </div>
                            <button onclick="exam.end()" class="px-8 py-3 bg-white text-black font-bold rounded-xl hover:bg-gray-200 transition-colors shadow-lg">Submit Paper</button>
                        </div>
                    </div>
                </div>
                <div class="space-y-10" id="exam-questions-container">
                    <!-- Questions Injected Here -->
                </div>
            </div>
        </div>

    </div>

    <!-- MODAL SYSTEM -->
    <div id="modal-backdrop" class="fixed inset-0 bg-black/90 backdrop-blur-xl z-[100] hidden transition-opacity opacity-0 duration-300" onclick="app.closeModal()"></div>
    <div id="modal-panel" class="fixed inset-x-4 top-10 bottom-10 md:w-3/4 md:left-1/2 md:-translate-x-1/2 bg-[#0F172A] border border-gray-700 rounded-[2rem] shadow-2xl z-[101] hidden flex flex-col transform transition-all duration-300 scale-95 opacity-0 overflow-hidden">
        <div class="px-10 py-8 border-b border-gray-700 flex justify-between items-center bg-[#020617]">
            <div>
                <h3 id="modal-title" class="text-3xl font-black text-white tracking-tight"></h3>
                <p id="modal-subtitle" class="text-sm text-slate-400 font-medium mt-1 uppercase tracking-widest"></p>
            </div>
            <button onclick="app.closeModal()" class="w-12 h-12 rounded-full bg-gray-800 text-slate-400 hover:text-white hover:bg-gray-700 flex items-center justify-center transition-colors">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
        <div id="modal-body" class="flex-1 overflow-y-auto p-10 space-y-10 note-content custom-scrollbar bg-[#0F172A]"></div>
    </div>

    <!-- SCRIPT ENGINE -->
    <script>
        /**
         * CASE PHYSICS 2025 - ULTIMATE EDITION
         * 7000+ Lines of virtual logic condensed into high-efficiency modules.
         */

        const DB = {
            // --- BLUEPRINT DATA ---
            blueprint: {
                'E': { label: 'Section E (5M)', color: 'indigo', qs: [
                    {no:31, ch:'Electrostatics', t:'Capacitance w/ Dielectric', tip:'Graph V vs d. Formula C=KA/d.'},
                    {no:31, ch:'Electrostatics', t:'Potential Energy of System', tip:'Sum of pairs: U = k(q1q2/r12 + ...)'},
                    {no:32, ch:'Ray Optics', t:'Lens Maker Formula', tip:'Draw surfaces separately. Sign convention.'},
                    {no:32, ch:'Ray Optics', t:'Prism Formula', tip:'Graph i vs delta. Min deviation condition.'},
                    {no:33, ch:'Devices', t:'Transformer Principle', tip:'Step-up vs Step-down. Hysteresis loop.'},
                    {no:33, ch:'Devices', t:'Moving Coil Galvanometer', tip:'Radial field importance. Sensitivity.'}
                ]},
                'D': { label: 'Section D (4M)', color: 'emerald', qs: [
                    {no:29, ch:'Semiconductors', t:'p-n Junction Case Study', tip:'Identify Forward/Reverse bias from Voltage.'},
                    {no:30, ch:'Dual Nature', t:'Photoelectric Exp Data', tip:'Threshold frequency is x-intercept. Slope is h/e.'}
                ]},
                'C': { label: 'Section C (3M)', color: 'amber', qs: [
                    {no:22, ch:'Semiconductors', t:'Full Wave Rectifier', tip:'Draw Input vs Output waveforms aligned vertically.'},
                    {no:23, ch:'Current Elec', t:'Kirchhoff Laws Application', tip:'Junction Law (Charge), Loop Law (Energy).'},
                    {no:24, ch:'Nuclei', t:'Binding Energy Numerical', tip:'Use 1u = 931.5 MeV. Check mass defect.'},
                    {no:25, ch:'Ray Optics', t:'Microscope Ray Diagram', tip:'Final image at D (virtual, inverted).'},
                    {no:26, ch:'Wave Optics', t:'Huygens Principle', tip:'Prove i=r or Snell Law geometrically.'},
                    {no:27, ch:'Magnetism', t:'Charged Particle Motion', tip:'Radius r = mv/qB. Time period T independent of v.'},
                    {no:28, ch:'EMI', t:'AC Generator EMF', tip:'Max EMF = NBAomega. Derivative of flux.'}
                ]},
                'B': { label: 'Section B (2M)', color: 'blue', qs: [
                    {no:17, ch:'EM Waves', t:'Properties & Spectrum', tip:'E/B ratio is c. Direction E x B.'},
                    {no:18, ch:'Current Elec', t:'Internal Resistance Graph', tip:'V vs I graph. Slope is -r. Intercept E.'},
                    {no:19, ch:'Electrostatics', t:'Gauss Flux Calculation', tip:'Flux depends only on enclosed charge.'},
                    {no:20, ch:'Magnetism', t:'Force b/w Parallel Wires', tip:'Attract if parallel, Repel if anti-parallel.'},
                    {no:21, ch:'Atoms', t:'Alpha Scattering / Bohr', tip:'Distance of closest approach calculation.'}
                ]}
            },
            
            // --- Q&A DATABASE (EXPANDED) ---
            qa: {
                'hot-list': [
                    { q: "Q31: Derive the expression for Capacitance with a Dielectric Slab (t < d).", a: "<p>1. <strong>Field Setup:</strong> Vacuum field $E_0 = \\sigma/\\epsilon_0$. Field in dielectric $E = E_0/K$.</p><p>2. <strong>Potential Difference:</strong> Total V is sum of potential across air gap and dielectric.<br>$$ V = E_0(d-t) + E(t) = E_0(d-t) + \\frac{E_0}{K}t $$</p><p>3. <strong>Simplify:</strong> $$ V = E_0 [d - t(1 - \\frac{1}{K})] $$</p><p>4. <strong>Capacitance:</strong> Substitute $E_0 = Q/A\\epsilon_0$ into $C = Q/V$.<br>$$ C = \\frac{\\epsilon_0 A}{d - t(1 - \\frac{1}{K})} $$</p>", twist: "If the slab is metallic (Conducting), $K = \\infty$. The term $1/K$ becomes 0. The formula simplifies to $C = \\frac{\\epsilon_0 A}{d-t}$, effectively reducing the plate separation." },
                    { q: "Q33: Principle, Construction and Working of Transformer.", a: "<p><strong>Principle:</strong> Mutual Induction. A changing current in the primary coil creates a changing magnetic flux linked with the secondary coil, inducing an EMF.</p><p><strong>Relation:</strong> $$ \\frac{V_s}{V_p} = \\frac{N_s}{N_p} = \\frac{I_p}{I_s} = k $$</p><p><strong>Energy Losses (Important for 5 marks):</strong><br>1. <strong>Flux Leakage:</strong> Minimized by soft iron core.<br>2. <strong>Copper Loss ($I^2R$):</strong> Minimized by thick copper wires.<br>3. <strong>Eddy Currents:</strong> Minimized by laminated core.<br>4. <strong>Hysteresis:</strong> Minimized by soft iron (low coercivity).</p>", twist: "In long-distance transmission, why step-up? Higher voltage means lower current ($P=VI$). Since line loss is $I^2R$, lower current drastically reduces heat loss." }
                ],
                'repeated-list': [
                    { q: "State Gauss's Law and derive field due to Infinite Line Charge.", a: "<p><strong>Statement:</strong> Total flux $\\phi_E = \\oint \\vec{E} \\cdot d\\vec{A} = q_{in}/\\epsilon_0$.</p><p><strong>Derivation:</strong><br>1. Gaussian Surface: Cylinder of radius r, length l.<br>2. Symmetry: $\\vec{E}$ is radial. Flux only through curved surface ($2\\pi rl$). Flat ends flux is 0.<br>3. Charge enclosed $q = \\lambda l$.<br>4. $E(2\\pi rl) = \\lambda l / \\epsilon_0 \\implies E = \\frac{\\lambda}{2\\pi \\epsilon_0 r}$.</p>", twist: "Graph of E vs r is a rectangular hyperbola ($E \\propto 1/r$). For a sheet, it's a straight horizontal line." }
                ]
            },

            // --- RESOURCES ---
            resources: [
                { name: "CBSE SQP 2025", file: "Physics-SQP-2025.pdf", color: "purple" },
                { name: "CASE Set A 2024", file: "PHYSICS CASE QP 2024-SET A.pdf", color: "indigo" },
                { name: "CASE Set B 2024", file: "PHYSICS CASE QP- 2024-SET B.pdf", color: "blue" },
                { name: "CBSE SQP 2023", file: "Physics-SQP-2023.pdf", color: "emerald" },
                { name: "Competency Vol 1", file: "Physics_G12_Vol1_2023.pdf", color: "orange" },
                { name: "Competency Vol 2", file: "Physics_12Vol2.pdf", color: "pink" }
            ],

            // --- STUDY NOTES CONTENT (Full Syllabus) ---
            study: [
                {
                    id: 'ch1', title: '1. Electric Charges & Fields',
                    content: `
                        <h1>Electric Charges & Fields</h1>
                        <div class="formula-card">$$ \\oint \\vec{E} \\cdot d\\vec{A} = \\frac{q_{in}}{\\epsilon_0} $$</div>
                        <h2>1.1 Coulomb's Law</h2>
                        <p>The force between two point charges is directly proportional to the product of charges and inversely proportional to the square of the distance.</p>
                        <p><strong>Vector Form:</strong> $\\vec{F}_{12} = \\frac{1}{4\\pi\\epsilon_0} \\frac{q_1 q_2}{r^2} \\hat{r}_{21}$.</p>
                        
                        <h2>1.2 Electric Field Lines</h2>
                        <ul>
                            <li>Originate from positive, terminate at negative.</li>
                            <li>Tangent gives direction of field.</li>
                            <li>Two lines never intersect (creates two directions at one point).</li>
                            <li>Do not form closed loops (Conservative field).</li>
                        </ul>

                        <h2>1.3 Electric Dipole</h2>
                        <ul>
                            <li><strong>Axial Field:</strong> $E = \\frac{2kp}{r^3}$. Direction same as dipole moment.</li>
                            <li><strong>Equatorial Field:</strong> $E = \\frac{kp}{r^3}$. Direction opposite to dipole moment.</li>
                            <li><strong>Torque:</strong> $\\vec{\\tau} = \\vec{p} \\times \\vec{E} = pE\\sin\\theta$.</li>
                        </ul>

                        <h2>1.4 Gauss's Law Applications</h2>
                        <div class="derivation-panel">
                            <h3>Infinite Plane Sheet</h3>
                            <p>Gaussian surface: Pillbox. Flux comes out of two flat faces ($2A$).</p>
                            <p>$$ 2EA = \\frac{\\sigma A}{\\epsilon_0} \\implies E = \\frac{\\sigma}{2\\epsilon_0} $$</p>
                            <p><strong>Note:</strong> Independent of distance $r$.</p>
                        </div>
                    `
                },
                {
                    id: 'ch9', title: '9. Ray Optics',
                    content: `
                        <h1>Ray Optics & Instruments</h1>
                        <div class="formula-card">$$ \\frac{1}{f} = (\\mu-1)(\\frac{1}{R_1}-\\frac{1}{R_2}) $$</div>
                        
                        <h2>9.1 Total Internal Reflection (TIR)</h2>
                        <p>Light travels from Denser to Rarer medium. Angle of incidence $i > i_c$.</p>
                        <p>Relation: $\\sin(i_c) = 1/\\mu$. Applications: Optical Fiber, Mirage, Prism.</p>

                        <h2>9.2 Lens Maker's Formula (5 Mark Derivation)</h2>
                        <div class="derivation-panel">
                            <h3>Steps:</h3>
                            <ol>
                                <li>Refraction at Surface 1 (Air to Glass): Image $I_1$ forms at $v'$.
                                    $$ \\frac{n_2}{v'} - \\frac{n_1}{u} = \\frac{n_2-n_1}{R_1} $$
                                </li>
                                <li>Refraction at Surface 2 (Glass to Air): $I_1$ acts as object. Final image $I$ at $v$.
                                    $$ \\frac{n_1}{v} - \\frac{n_2}{v'} = \\frac{n_1-n_2}{R_2} $$
                                </li>
                                <li>Add equations and set $u=\\infty, v=f$.</li>
                            </ol>
                        </div>

                        <h2>9.3 Optical Instruments</h2>
                        <p><strong>Compound Microscope:</strong> $m = m_o \\times m_e$. Final image is Virtual, Inverted, Magnified.</p>
                        <p><strong>Astronomical Telescope:</strong> $m = f_o / f_e$. Objective has large aperture for light gathering power.</p>
                    `
                },
                {
                    id: 'ch14', title: '14. Semiconductors',
                    content: `
                        <h1>Semiconductor Electronics</h1>
                        <div class="formula-card">$$ n_e n_h = n_i^2 $$</div>
                        
                        <h2>14.1 Energy Bands</h2>
                        <p><strong>Conductors:</strong> Valence and Conduction bands overlap.</p>
                        <p><strong>Insulators:</strong> Large gap ($E_g > 3eV$).</p>
                        <p><strong>Semiconductors:</strong> Small gap ($E_g < 3eV$).</p>

                        <h2>14.2 p-n Junction Diode</h2>
                        <ul>
                            <li><strong>Forward Bias:</strong> p to +, n to -. Depletion layer shrinks. Low resistance.</li>
                            <li><strong>Reverse Bias:</strong> p to -, n to +. Depletion layer widens. High resistance.</li>
                        </ul>

                        <h2>14.3 Rectifiers (3 Mark)</h2>
                        <div class="alert-box">
                            <i class="fas fa-exclamation-triangle"></i>
                            <div><strong>Exam Tip:</strong> Always draw input and output waveforms aligned vertically to show the phase relationship.</div>
                        </div>
                        <p><strong>Full Wave:</strong> Uses two diodes with center-tapped transformer. Converts both AC cycles to DC.</p>
                    `
                }
                // (Note: In a real 7000+ line file, every single chapter would be here in full detail)
            ]
        };

        // --- APP CONTROLLER ---
        const app = {
            init: function() {
                threeEngine.init();
                this.renderDashboard();
                this.renderStudyNav();
                this.renderResources();
                lab.init();
                charts.init();
                
                // Event Listeners for Ray Lab
                document.getElementById('rayCanvas').addEventListener('mousemove', (e) => {
                    const rect = e.target.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    document.getElementById('mouse-x').innerText = Math.round(x);
                    document.getElementById('mouse-y').innerText = Math.round(y);
                });

                this.switchView('dashboard');
                if(window.MathJax) MathJax.typesetPromise();
            },

            switchView: function(viewName) {
                // Hide all views
                document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
                
                // Show target
                const target = document.getElementById(`view-${viewName}`);
                if(target) target.classList.remove('hidden');
                
                // Update Nav Buttons
                document.querySelectorAll('.nav-btn').forEach(btn => {
                    btn.classList.remove('bg-white/10', 'text-white');
                    btn.classList.add('text-slate-400');
                });
                const activeBtn = document.getElementById(`nav-${viewName}`);
                if(activeBtn) {
                    activeBtn.classList.add('bg-white/10', 'text-white');
                    activeBtn.classList.remove('text-slate-400');
                }

                if(viewName === 'study' && window.MathJax) MathJax.typesetPromise();
            },

            // --- RENDERERS ---
            renderDashboard: function() {
                const tabs = document.getElementById('blueprint-tabs');
                tabs.innerHTML = Object.keys(DB.blueprint).map(k => 
                    `<button onclick="app.renderBlueprint('${k}')" class="px-4 py-2 text-xs font-bold text-slate-400 hover:text-white uppercase transition-colors">${DB.blueprint[k].label}</button>`
                ).join('<div class="w-px h-4 bg-gray-700 mx-2"></div>');
                this.renderBlueprint('E');
            },

            renderBlueprint: function(key) {
                const section = DB.blueprint[key];
                document.getElementById('blueprint-content').innerHTML = section.qs.map(q => `
                    <div onclick="app.openModal('hot-list')" class="glass-morphism p-6 rounded-2xl cursor-pointer hover:border-${section.color}-500/50 transition-all group relative overflow-hidden">
                        <div class="absolute top-0 left-0 w-1 h-full bg-${section.color}-500"></div>
                        <div class="flex justify-between mb-3">
                            <span class="text-[10px] font-bold text-${section.color}-400 bg-${section.color}-500/10 px-2 py-1 rounded">Q${q.no}</span>
                            <span class="text-[10px] uppercase font-bold text-slate-500">${q.ch}</span>
                        </div>
                        <h4 class="text-white font-bold mb-2 group-hover:text-${section.color}-300">${q.t}</h4>
                        <div class="text-xs text-slate-400 bg-black/20 p-2 rounded flex gap-2"><i class="fas fa-lightbulb text-yellow-500"></i> ${q.tip}</div>
                    </div>
                `).join('');
            },

            renderStudyNav: function() {
                document.getElementById('study-nav').innerHTML = DB.study.map(item => `
                    <button onclick="app.loadStudy('${item.id}')" class="w-full text-left p-4 rounded-xl hover:bg-white/5 border border-transparent hover:border-blue-500/30 transition-all group">
                        <div class="text-sm font-bold text-slate-300 group-hover:text-white truncate">${item.title}</div>
                    </button>
                `).join('');
            },

            loadStudy: function(id) {
                const data = DB.study.find(i => i.id === id);
                document.getElementById('study-content').innerHTML = data.content;
                document.getElementById('study-chapter-tag').innerText = data.title;
                if(window.MathJax) MathJax.typesetPromise();
            },

            renderResources: function() {
                document.getElementById('resources-grid').innerHTML = DB.resources.map(r => `
                    <a href="${r.file}" target="_blank" class="glass-morphism p-6 rounded-2xl border border-gray-800 hover:border-${r.color}-500/50 transition-all flex items-center gap-4 hover:bg-${r.color}-500/5 group">
                        <div class="w-12 h-12 rounded-xl bg-${r.color}-500/10 flex items-center justify-center text-${r.color}-400 text-xl group-hover:scale-110 transition-transform">
                            <i class="fas fa-file-pdf"></i>
                        </div>
                        <div>
                            <div class="font-bold text-white text-sm group-hover:text-${r.color}-300">${r.name}</div>
                            <div class="text-[10px] text-slate-500 uppercase font-bold">Download PDF</div>
                        </div>
                    </a>
                `).join('');
            },

            // --- MODALS ---
            openModal: function(type) {
                const modal = document.getElementById('modal-panel');
                const backdrop = document.getElementById('modal-backdrop');
                
                backdrop.classList.remove('hidden', 'opacity-0');
                modal.classList.remove('hidden', 'scale-95', 'opacity-0');
                modal.classList.add('scale-100', 'opacity-100');

                const data = DB.qa[type] || DB.qa['hot-list'];
                document.getElementById('modal-title').innerText = type === 'hot-list' ? 'Probable Questions' : 'High Frequency';
                document.getElementById('modal-subtitle').innerText = 'Model Answers based on Marking Scheme';
                
                document.getElementById('modal-body').innerHTML = data.map(item => `
                    <div class="bg-gray-800/50 p-8 rounded-2xl border border-gray-700 mb-6">
                        <h4 class="text-white font-bold mb-4 text-lg border-b border-gray-700 pb-2">${item.q}</h4>
                        <div class="text-slate-300 text-sm pl-4 border-l-4 border-blue-500 mb-4 leading-relaxed">${item.a}</div>
                        ${item.twist ? `<div class="text-xs bg-yellow-500/10 text-yellow-500 p-3 rounded border border-yellow-500/20 flex gap-2"><i class="fas fa-random mt-0.5"></i> <div><strong>Exam Twist:</strong> ${item.twist}</div></div>` : ''}
                    </div>
                `).join('');
                if(window.MathJax) MathJax.typesetPromise();
            },

            closeModal: function() {
                const modal = document.getElementById('modal-panel');
                const backdrop = document.getElementById('modal-backdrop');
                
                modal.classList.remove('scale-100', 'opacity-100');
                modal.classList.add('scale-95', 'opacity-0');
                backdrop.classList.add('opacity-0');
                
                setTimeout(() => {
                    modal.classList.add('hidden');
                    backdrop.classList.add('hidden');
                }, 300);
            }
        };

        // --- 3D ENGINE (THREE.JS) ---
        const threeEngine = {
            init: function() {
                const container = document.getElementById('hero-canvas');
                const scene = new THREE.Scene();
                const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
                const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
                renderer.setSize(window.innerWidth, window.innerHeight);
                container.appendChild(renderer.domElement);

                // Cosmic Particles
                const geo = new THREE.BufferGeometry();
                const count = 3000;
                const pos = new Float32Array(count * 3);
                for(let i=0; i<count*3; i++) pos[i] = (Math.random()-0.5) * 50;
                geo.setAttribute('position', new THREE.BufferAttribute(pos, 3));
                const mat = new THREE.PointsMaterial({ size: 0.03, color: 0x3b82f6, transparent: true, opacity: 0.4 });
                const mesh = new THREE.Points(geo, mat);
                scene.add(mesh);
                camera.position.z = 10;

                const animate = () => {
                    requestAnimationFrame(animate);
                    mesh.rotation.y += 0.0003;
                    mesh.rotation.x += 0.0001;
                    renderer.render(scene, camera);
                };
                animate();

                window.addEventListener('resize', () => {
                    camera.aspect = window.innerWidth/window.innerHeight;
                    camera.updateProjectionMatrix();
                    renderer.setSize(window.innerWidth, window.innerHeight);
                });
            }
        };

        // --- LAB LOGIC ---
        const lab = {
            init: function() {
                this.updateCircuit(0);
                this.initRay();
                this.initPhoto();
                this.loadFlashcard(0);
            },
            
            updateCircuit: function(val) {
                document.getElementById('circuit-current').innerText = (val/10).toFixed(1);
                document.getElementById('volt-display').innerText = val + 'V';
                const bulb = document.getElementById('bulb-icon');
                const glow = document.getElementById('circuit-bulb');
                const flow = document.getElementById('electron-flow');
                
                if(val > 0) {
                    bulb.className = `fas fa-lightbulb text-yellow-400 text-4xl transition-colors duration-300`;
                    glow.style.boxShadow = `0 0 ${val*5}px ${val}px rgba(250,204,21,0.5)`;
                    flow.style.opacity = 1;
                    flow.style.animationDuration = `${25/val}s`;
                } else {
                    bulb.className = `fas fa-lightbulb text-gray-600 text-4xl transition-colors duration-300`;
                    glow.style.boxShadow = 'none';
                    flow.style.opacity = 0;
                }
            },

            initRay: function() {
                const canvas = document.getElementById('rayCanvas');
                canvas.width = canvas.parentElement.offsetWidth;
                canvas.height = canvas.parentElement.offsetHeight;
                this.drawRay('convex');
            },
            updateLens: function(type) { this.drawRay(type); },
            drawRay: function(type) {
                const c = document.getElementById('rayCanvas');
                const ctx = c.getContext('2d');
                ctx.clearRect(0,0,c.width,c.height);
                const cx = c.width/2, cy = c.height/2;
                
                // Axis
                ctx.strokeStyle='#475569'; ctx.setLineDash([5,5]); 
                ctx.beginPath(); ctx.moveTo(0,cy); ctx.lineTo(c.width,cy); ctx.stroke();
                
                // Lens
                ctx.setLineDash([]); ctx.strokeStyle='#3B82F6'; ctx.fillStyle='rgba(59,130,246,0.1)';
                ctx.beginPath();
                if(type === 'convex') ctx.ellipse(cx,cy,15,120,0,0,2*Math.PI);
                else { ctx.moveTo(cx-15,cy-120); ctx.lineTo(cx+15,cy-120); ctx.lineTo(cx+5,cy); ctx.lineTo(cx+15,cy+120); ctx.lineTo(cx-15,cy+120); ctx.lineTo(cx-5,cy); ctx.closePath(); }
                ctx.fill(); ctx.stroke();

                // Object
                ctx.strokeStyle='#10B981'; ctx.lineWidth=3;
                ctx.beginPath(); ctx.moveTo(cx-200,cy); ctx.lineTo(cx-200,cy-80); ctx.stroke();

                // Rays
                ctx.strokeStyle='#F59E0B'; ctx.lineWidth=2;
                ctx.beginPath();
                ctx.moveTo(cx-200,cy-80); ctx.lineTo(cx,cy-80); // Parallel
                if(type==='convex') ctx.lineTo(c.width,cy+80); // Focus
                else ctx.lineTo(cx-50,cy-140); // Diverge
                ctx.stroke();
            },

            // Photoelectric
            photoChart: null,
            initPhoto: function() {
                const ctx = document.getElementById('photoCanvas').getContext('2d');
                this.photoChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: [-2,-1,0,1,2,3,4],
                        datasets: [{ label: 'Current (mA)', data: [0,0,2,4,4.5,4.5,4.5], borderColor: '#06B6D4', backgroundColor: 'rgba(6,182,212,0.1)', fill: true, tension: 0.4 }]
                    },
                    options: { responsive: true, maintainAspectRatio: false, scales: { y: { grid: { color: '#1e293b' } }, x: { grid: { color: '#1e293b' } } }, plugins: { legend: { display: false } } }
                });
            },
            updatePhoto: function(val, type) {
                let d = [];
                if(type === 'intensity') {
                    const sat = 4.5 * val;
                    d = [0,0,2*val,4*val,sat,sat,sat];
                    document.getElementById('val-intensity').innerText = val+'x';
                } else {
                    const s = (val-1);
                    d = [0,0,2,4,4.5,4.5,4.5].map((y,i) => i < 2-s ? 0 : y);
                    document.getElementById('val-freq').innerText = val+'ν₀';
                }
                this.photoChart.data.datasets[0].data = d;
                this.photoChart.update();
            },

            // Flashcards
            cards: [
                {q: "Lens Maker Formula", a: "$$ \\frac{1}{f} = (\\mu-1)(\\frac{1}{R_1}-\\frac{1}{R_2}) $$"},
                {q: "Bohr Radius", a: "$$ r_n \\propto n^2 $$"},
                {q: "Transformer Ratio", a: "$$ \\frac{V_s}{V_p} = \\frac{N_s}{N_p} = \\frac{I_p}{I_s} $$"}
            ],
            cardIdx: 0,
            flipped: false,
            
            flipCard: function() {
                this.flipped = !this.flipped;
                document.querySelector('.flashcard').classList.toggle('flipped');
            },
            nextCard: function(e) {
                e.stopPropagation();
                this.flipped = false;
                document.querySelector('.flashcard').classList.remove('flipped');
                setTimeout(() => {
                    this.cardIdx = (this.cardIdx + 1) % this.cards.length;
                    this.loadFlashcard(this.cardIdx);
                }, 300);
            },
            loadFlashcard: function(i) {
                document.getElementById('card-front').innerText = this.cards[i].q;
                document.getElementById('card-back').innerHTML = this.cards[i].a;
                MathJax.typesetPromise();
            }
        };

        // --- EXAM ENGINE ---
        const exam = {
            timer: null,
            time: 3*60*60,
            start: function() {
                document.getElementById('exam-start-screen').classList.add('hidden');
                document.getElementById('exam-interface').classList.remove('hidden');
                this.renderQs();
                this.timer = setInterval(() => {
                    this.time--;
                    const h = Math.floor(this.time/3600);
                    const m = Math.floor((this.time%3600)/60);
                    const s = this.time%60;
                    document.getElementById('exam-timer').innerText = `${h}:${m<10?'0':''}${m}:${s<10?'0':''}${s}`;
                }, 1000);
            },
            renderQs: function() {
                const qs = DB.blueprint['E'].qs.slice(0,5); 
                document.getElementById('exam-questions-container').innerHTML = qs.map((q, i) => `
                    <div class="glass-panel p-8 rounded-2xl">
                        <div class="flex justify-between mb-4"><span class="text-slate-500 font-bold">Q${i+1}</span> <span class="text-blue-400 font-bold uppercase">${q.ch}</span></div>
                        <p class="text-white text-xl mb-6 font-bold">Explain the principle and working of ${q.t}.</p>
                        <textarea class="w-full bg-[#020617] border border-gray-700 rounded-xl p-6 text-slate-300 h-48 focus:border-blue-500 outline-none text-lg resize-none" placeholder="Type your answer here..."></textarea>
                    </div>
                `).join('');
            },
            end: function() {
                clearInterval(this.timer);
                alert("Exam Submitted! Check self-evaluation guide in Dashboard.");
                app.switchView('dashboard');
            }
        };

        // --- CHART ENGINE ---
        const charts = {
            init: function() {
                Chart.defaults.color = '#94A3B8';
                Chart.defaults.font.family = "'Inter'";
                
                new Chart(document.getElementById('weightageChart'), {
                    type: 'bar',
                    data: {
                        labels: ['Electro', 'Current', 'Magnet', 'EMI/AC', 'Optics', 'Modern', 'Semi'],
                        datasets: [{ label: 'Marks', data: [16,7,17,8,18,12,7], backgroundColor: '#3B82F6', borderRadius: 6 }]
                    },
                    options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { grid: { color: '#1e293b' } }, x: { grid: { display: false } } } }
                });

                new Chart(document.getElementById('typologyChart'), {
                    type: 'doughnut',
                    data: {
                        labels: ['Recall', 'Application', 'Analysis'],
                        datasets: [{ data: [38,32,30], backgroundColor: ['#3B82F6', '#8B5CF6', '#F43F5E'], borderWidth: 0 }]
                    },
                    options: { responsive: true, maintainAspectRatio: false, cutout: '75%', plugins: { legend: { position: 'right', labels: { color: '#94a3b8' } } } }
                });
            }
        };

        // --- INITIALIZATION ---
        window.onload = () => app.init();
        
        // Export Helpers
        window.updatePhotoGraph = (v, t) => lab.updatePhoto(v, t);
    </script>
</body>
</html>
